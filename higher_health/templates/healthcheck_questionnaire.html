{% extends 'base.html' %}
{% load temp_tags static %}
{% block content %}
  <div class="content">
    <div class="content-intro">
      <div class="content-inner">
        <div class="heading-container">
          <h1 class="heading heading-primary">Welcome to HealthCheck</h1>
          <h2 class="heading heading-secondary">Your daily risk assessment tool.</h2>
          <h3 class="heading heading-subtitle">Please help us by answering a few questions about you and your health.</h3>
          <p>
            You will receive advice on what actions to take based on national guidelines,
            and the data you enter will help us in predictive modelling and planning
            our national response to COVID-19.

            Thank you for coming forward and for contributing to the
            health of all citizens AND stopping the spread of the virus ðŸ¦ 
          </p>
        </div>
        <form action="" method="POST" id="login_form" class="login-form" novalidate>
        {% csrf_token %}
          <div class="login-form__read-terms">
            <ul id="read-terms" class="fieldset">
              <li class="fieldset__item">
                <input type="checkbox" id="healthcheck_terms" name="healthcheck-terms" required>
                <label for="healthcheck_terms" class="label">I accept the terms</label>
                <a href="/terms" class="label-link" target="_blank">Read terms and policy</a>
              </li>
            </ul>
          </div>
          <div id="questionnaires">
            <div class="login-form__location">
              <p class="pagination-ux">Step 1 of 4</p>
              <h2 class="heading-secondary">Registration</h2>
              <div class="login-form__screening">
                {% if form.errors %}
                  <p class="error">Please correct the errors below</p>
                {% endif %}
                <ul id="registration" class="fieldset">
                  {% with 'city address route country street_number' as field_list %}
                    {% for field in form %}
                      {% if "history_" not in field.name and "facility_" not in field.name and "symptoms_" not in field.name and "medical_" not in field.name and field.name not in field_list.split %}
                        <li class="fieldset__item">
                          {% if field|field_type != "HiddenInput" %}

                            <label for="{{ field.id_for_label }}" class="label">
                              {{field.label}}
                            </label>
                            {{field}}
                            {{field.errors}}
                          {% endif %}
                        </li>
                      {% endif %}
                    {% endfor %}
                  {% endwith %}
                </ul>
              </div>
              <p class="subtitle">Sharing your location data will help us to further accurately map cases of COVID-19</p>
              <div class="login-form__map">
                <div id="locationField">
                  <input id="autocomplete"
                    placeholder="Type your physical address"
                    onFocus="geolocate()"
                    type="text"
                    value="{{ form.address.value|default_if_none:'' }}"
                    name="address"/>
                    {% if form.address.errors  %}{{form.address.errors}}{% endif %}
                </div>
                {% if form.latitude or form.longitude %}
                  {{form.latitude}}
                  {{form.longitude}}
                {% endif %}
                <div class="location-field-autoload">
                  <p class="location-field-hint">The below physical address fields will be automatically populated from the address entered above. Otherwise please fill in the information.</p>
                  <ul id="address" class="address-list fieldset">
                    <li class="address-list__item">
                      <input class="field" name="street_number" id="street_number" readonly value="{{ form.street_number.value|default_if_none:'' }}"/>
                      <input class="field" name="route" id="route" readonly value="{{ form.route.value|default_if_none:'' }}"/>
                      <label for="street_number" class="label">Street address:</label>
                    </li>
                    <li class="address-list__item">
                      <input class="field" name="city" id="locality" readonly value="{{ form.city.value|default_if_none:'' }}"/>
                      <label for="locality" class="label">City:</label>
                    </li>
                    <li class="address-list__item">
                      <input class="field" name="country" id="country" readonly value="{{ form.country.value|default_if_none:'' }}"/>
                      <label for="country" class="label">Country:</label>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="login-form__medical">
              <p class="pagination-ux">Step 2 of 4</p>
              <h2 class="heading-secondary">Where are you going today?</h2>
              <ul id="destination" class="fieldset">
                {% for field in form %}
                  {% if "facility_" in field.name %}
                    {% if field.name == "facility_destination_university" %}
                      <h3 class="heading-subtitle heading-subtitle--edu-label">Educational institution information</h3>
                    {% endif %}
                    <li class="fieldset__item">
                      <label for="{{ field.name }}" class="label">{{ field.label }}</label>
                      {{ field }}
                      {{field.errors}}
                    </li>
                  {% endif %}
                {% endfor %}
              </ul>
            </div>

            <div class="login-form__medical">
              <p class="pagination-ux">Step 3 of 4</p>
              <h2 class="heading-secondary">Medical History</h2>
              <ul id="medical-history" class="fieldset">
                <li class="fieldset__medical">
                  <label for="{{ form.history_pre_existing_condition.name }}" class="label">{{ form.history_pre_existing_condition.label }}</label>
                  {{ form.history_pre_existing_condition }}
                  {{form.history_pre_existing_condition.errors}}
                </li>
              </ul>
              <ul id="preexistingconditionsForm" class="fieldset">
                {% for field in form %}
                  {% if "history_" in field.name and field.name != 'history_pre_existing_condition' %}
                  <li class="fieldset__medical">
                      <label for="{{ field.name }}" class="label">{{ field.label }}</label>
                      {{ field }}
                      {{field.errors}}
                    </li>
                  {% endif %}
                {% endfor %}
              </ul>
            </div>

            <div class="login-form__medical">
              <p class="pagination-ux">Step 4 of 4</p>
              <h2 class="heading-secondary">How are you feeling today?</h2>
              <ul id="medical" class="fieldset">
                {% for field in form %}
                  {% if "symptoms_" in field.name or "medical_" in field.name %}
                    {% if field.name == "medical_confirm_accuracy" %}
                      <h3 class="heading-subtitle heading-subtitle--edu-label">Confirmation</h3>
                    {% endif %}
                    <li class="fieldset__item">
                      <label for="{{ field.name }}" class="label">{{ field.label }}</label>
                      {{ field }}
                      {{field.errors}}
                    </li>
                  {% endif %}
                {% endfor %}
              </ul>
            </div>
            <button id="entrySubmit" type="submit" class="cta cta-primary">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>
{% endblock %}

{% block form_js %}
  <script type="text/javascript">
  "use strict";
    let universities = {
      {% for uni in form.fields.facility_destination_university.choices.queryset %}
        "{{ uni.pk }}": "{{ uni.province }}" {% if not forloop.last %},{% endif %}
      {% endfor %}
    },
    campuses = {
      {% for camp in form.fields.facility_destination_campus.choices.queryset %}
        "{{ camp.pk }}": "{{ camp.university.pk }}" {% if not forloop.last %},{% endif %}
      {% endfor %}
    };
  </script>
  <script type="text/javascript" src="{% static 'js/main-min.js' %}"></script>
  <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key={{PLACES_API_KEY}}&libraries=places&callback=initAutocomplete"
      async defer></script>
{% endblock %}
